version: '2'

volumes:
  zmcache:
    driver: local
    driver_opts:
      o: bind
      type: none
      device: /mnt/data/ZM_DATA/zmcache
  zmlog:
    driver: local
    driver_opts:
      o: bind
      type: none
      device: /mnt/data/ZM_DATA/zmlog
  zmapachelog:
    driver: local
    driver_opts:
      o: bind
      type: none
      device: /mnt/data/ZM_DATA/zmapachelog
  db:
    driver: local
    driver_opts:
      o: bind
      type: none
      device: /mnt/data/ZM_DATA/db

services:
  mariadb:
    image: mariadb:11.1-jammy
    restart: always
    command: --transaction-isolation=READ-COMMITTED --binlog-format=ROW --default-time-zone=Europe/Saratov
    volumes:
      - db:/var/lib/mysql:Z
    environment:
      - MYSQL_PASSWORD=zmpass
      - MYSQL_DATABASE=zm
      - MYSQL_USER=zmuser
      - MARIADB_ROOT_PASSWORD=w8t67u23789t
      - TZ=Europe/Saratov
#
#    ports:
#      - 3306:3306
#
  zm:
    build:
      context: .
      dockerfile: ./Dockerfile
    image: zhadaevfm/docker-zoneminder
    restart: always
    shm_size: 1G
#
    ports:
      - 8081:80
    links:
      - mariadb
#    network_mode: "host"
#
    tmpfs:
      - /run
      - /tmp
    volumes:
      - zmcache:/var/cache/zoneminder:Z
      - zmlog:/var/log/zm:Z
      - zmapachelog:/var/log/apache2:Z
      - ./data/es_rules.json:/etc/zm/es_rules.json:Z
      - ./data/secrets.ini:/etc/zm/secrets.ini:Z
      - ./data/zmeventnotification.ini:/etc/zm/zmeventnotification.ini:Z
      - ./data/objectconfig.ini:/etc/zm/objectconfig.ini:Z
    environment:
      - ZM_DB_PASS=zmpass
      - ZM_DB_NAME=zm
      - ZM_DB_USER=zmuser
#      - ZM_DB_HOST=127.0.0.1
      - TZ=Europe/Saratov
